#!/usr/bin/env php
<?php

// load autoloader
$pathes = [
    __DIR__ . '/../vendor/autoload.php',
    __DIR__ . '/../autoload.php'
];

foreach ($pathes as $path) {
    if (file_exists($path)) {
        require_once $path;
    }
}

$cmd = "./vendor/bin/phpstan analyse -c phpstan.neon --no-progress --error-format=markdown";
$stream = popen($cmd, "r");
$output = stream_get_contents($stream);
fclose($stream);

if ($output !== '') {
    echo $output;

    (new \Rozeo\PHPStanAction\PullRequestResponder(
        getenv('GITHUB_URL'),
        getenv('GITHUB_TOKEN'),
        $output
    ))->execute();
    exit(1);
}

exit(0);